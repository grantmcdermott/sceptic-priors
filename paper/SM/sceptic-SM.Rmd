---
title: "Supplementary Material"
subtitle: "Sceptic priors and climate consensus"
author: "Grant McDermott"
# date: "10/14/2020"
bibliography: ../sceptic/sceptic.bib
output: 
  pdf_document:
    latex_engine: xelatex
    # toc: true
    citation_package: natbib
    dev: cairo_pdf
header-includes: 
  - \usepackage{fontspec}
  - \usepackage{booktabs}
  - \usepackage{tabularx}
  - \usepackage{threeparttable}
  - \usepackage{dcolumn}
  - \newcolumntype{A}{D{.}{.}{2.3}}
  - \usepackage{sectsty} % Allows your to change titles style
  - \allsectionsfont{\sffamily} % Define the style of all titles
mainfont: texgyrepagella-regular.otf
sansfont: Fira Sans
---

\newcommand{\beginsupplement}{%
	\setcounter{table}{0}
	\renewcommand{\thetable}{SM\arabic{table}}%
	\setcounter{figure}{0}
	\renewcommand{\thefigure}{SM\arabic{figure}}%
}
\beginsupplement

\listoftables
\listoffigures
\newpage


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	cache = TRUE, 
	echo = FALSE, 
	warning = FALSE,
	message = FALSE,
	fig.path = here::here('figs/'),
	fig.align = 'center',
	out.width = '100%',
	dpi=300
	)
```

```{r libs, cache=FALSE, message=FALSE}
library(fst)
library(data.table)
library(ggplot2)
library(ggridges)
library(forcats)
library(hrbrthemes)
library(extrafont)
library(kableExtra)
library(here)

# Functions and global elements ----

## Match short prior names to long prior names
match_priors = function(x) {
	x = gsub('ni', 'Noninformative', x)
	x = gsub('lukemod', 'Moderate Lukewarmer', x)
	x = gsub('lukestrong', 'Strong Lukewarmer', x)
	x = gsub('denmod', 'Moderate Denier', x)
	x = gsub('denstrong', 'Strong Denier', x)
	return(x)
}

## Match short RCP names to long RCP names
match_rcps = function(x) {
  x <- gsub('rcp26', rcp_names[1], x)
  x <- gsub('rcp45', rcp_names[2], x)
  x <- gsub('rcp60', rcp_names[3], x)
  x <- gsub('rcp85', rcp_names[4], x)
  return(x)
}

## Assign colours and names for later graphs ##
rcp_names = c('(a) RCP 2.6', '(b) RCP 4.5', '(c) RCP 6.0', '(d) RCP 8.5')
rcp_cols = scales::viridis_pal(option='plasma')(9)[c(1,3,5,7)] 

prior_names = c('Strong Denier', 'Moderate Denier', 
                'Strong Lukewarmer', 'Moderate Lukewarmer', 'Noninformative')
# c(brewer.pal(12, 'Paired')[c(2, 1, 6, 5)], '#000000') ## Want slightly darker for light pairs
prior_cols = c('Strong Denier'='#1F78B4', 'Moderate Denier'='#8BBDDA',
               'Strong Lukewarmer'='#E31A1C', 'Moderate Lukewarmer'='#F68080',
               'Noninformative'='#000000')

# Plot theme and font ----

## Fira Sans font for figures. Download here: https://bboxtype.com/typefaces/FiraSans/#!layout=specimen
## Must then register with R. See here: https://github.com/wch/extrafont 
## Will revert to ggplot2 default if not installed.
font_type = choose_font('Fira Sans')

## Set global plot theme 
theme_set(
  theme_ipsum(
    # base_size = 12,
    # axis_title_size = 14,
  	axis_title_size = 12,
    axis_title_just = 'c'
    ) +
    theme(
      text = element_text(family = font_type),
      strip.text = element_text(hjust = 0.5)
      )
  )
```

```{r data}
# climate = fread(here('data/climate.csv'))
# priors_dt = fread(here('data/priors.csv'))
# params = fread(here('results/main/params.csv'))
# tcr = read_fst(here('results/main/tcr.fst')); setDT(tcr)
# gmst_pred = fread(here('results/main/gmst-pred.csv'))
# gmst2100 = read_fst(here('results/main/gmst2100.fst')); setDT(gmst2100)
# tcr_rec = fread(here('results/recursive/tcr-rec.csv'))
# evid = fread(here('results/evidence/evid.csv'))
scc = fread(here('results/PAGE09/scc.csv'))
```


# Tables

\begin{table}[ht] \centering 
	\caption{TCR efficacies} 
	\label{tab:marvel} 
	\begin{threeparttable} 
		\begin{tabular}{@{\extracolsep{5pt}} lcc}
			\toprule
			Forcing agent & Mean &   95\% C.I.   \\ 
			\midrule
			Aerosols      & 1.55 & (1.05, 2.05)  \\
			GHGs          & 1.17 & (1.07, 1.28)  \\
			Land use      & 3.82 & (-2.16, 9.80) \\
			Ozone         & 0.66 & (0.34, 0.98)  \\
			Solar         & 1.68 & (-1.27, 4.63)  \\
			Volcanic      & 0.61 & (0.33, 0.89)  \\ 
			\bottomrule
		\end{tabular} 
		\begin{tablenotes}
			\footnotesize
			\item Adapted from Table S1 of \cite{marvel2016implications}. Confidence intervals on the sample means are constructed from a \textit{t} distribution with 4 degrees of freedom.
		\end{tablenotes}
	\end{threeparttable} 
\end{table} 

<!-- \vspace{1cm} -->

<!-- \begin{table}[h] \centering -->
<!-- 	%\begin{adjustwidth}{-.1in}{-.1in}%{-.55in}{-.55in}   -->
<!-- 	\caption{Posterior TCRs when separating anthropogenic sources from other forcings (robustness check)}  -->
<!-- 	\label{tab:anthro}  -->
<!-- %	\begin{adjustwidth}{-1cm}{-1cm} -->
<!-- 		%  \scriptsize  -->
<!-- 		\footnotesize %%% added %%% -->
<!-- 		\begin{threeparttable} %%% added %%% -->
<!-- 			%\begin{tabular}{@{\extracolsep{1pt}} D{.}{.}{-3} D{.}{.}{-3} D{.}{.}{-3} D{.}{.}{-3} D{.}{.}{-3} D{.}{.}{-3} }  -->
<!-- 			\begin{tabularx}{.9\linewidth}{ l X X X X X} -->
<!-- 				%\\[-1.8ex]\hline  -->
<!-- 				%\hline \\[-1.8ex]  -->
<!-- %				\multicolumn{6}{c}{\normalsize \footnotesize Dependent variable: Global Mean Surface Temperature anomaly ($^\circ$C)} \\ \\[-1.8ex]\hline  -->
<!-- 				\toprule %%% changed %%%%  -->
<!-- 				\multicolumn{1}{c}{} &  & \multicolumn{2}{c}{Lukewarmer} & \multicolumn{2}{c}{Denier} \\  %\\[-1.8ex]  -->
<!-- 				\cmidrule(lr){3-4}\cmidrule(lr){5-6} -->
<!-- 				\multicolumn{1}{c}{} & \multicolumn{1}{c}{Noninformative} & \multicolumn{1}{c}{Moderate} & \multicolumn{1}{c}{Strong} & \multicolumn{1}{c}{Moderate} & \multicolumn{1}{c}{Strong} \\   -->
<!-- 				\midrule -->
<!-- 				\multicolumn{1}{l}{TCR (anthropogenic)} & \multicolumn{1}{c}{1.5} & \multicolumn{1}{c}{1.5} & \multicolumn{1}{c}{1.2} & \multicolumn{1}{c}{1.4} & \multicolumn{1}{c}{0.3} \\  -->
<!-- 				\multicolumn{1}{c}{} & \multicolumn{1}{c}{[1.4, 1.8]} & \multicolumn{1}{c}{[1.3, 1.7]} & \multicolumn{1}{c}{[1.1, 1.4]} & \multicolumn{1}{c}{[1.2, 1.6]} & \multicolumn{1}{c}{[0.2, 0.5]} \\  -->
<!-- 				\midrule				 -->
<!-- 				\multicolumn{1}{l}{TCR (CO$_2$)} & \multicolumn{1}{c}{1.7} & \multicolumn{1}{c}{1.5} & \multicolumn{1}{c}{1.1} & \multicolumn{1}{c}{1.3} & \multicolumn{1}{c}{0.2} \\  -->
<!-- 				\multicolumn{1}{c}{} & \multicolumn{1}{c}{[1.4, 2]} & \multicolumn{1}{c}{[1.2, 1.8]} & \multicolumn{1}{c}{[1, 1.3]} & \multicolumn{1}{c}{[1, 1.5]} & \multicolumn{1}{c}{[0.1, 0.3]} \\  -->

<!-- 				\\[-1.8ex] -->
<!-- 				%\hline \\[-1.8ex]  -->
<!-- 				\bottomrule -->
<!-- 			\end{tabularx}  -->
<!-- 			\begin{tablenotes} -->
<!-- 				\footnotesize %\scriptsize -->
<!-- 				\item Implied TCR values are derived from an alternative implementation of regression equation~\ref{eq:regression}. In the first case, anthropogenic forcings are entered separately from natural forcings. In the second, CO$_2$ forcings are entered separately from all other sources. See main text for details. While the underlying regression coefficients are omitted for brevity, the notes from Table~\ref{tab:reg-coefs} all apply.  -->
<!-- 			\end{tablenotes} -->
<!-- 		\end{threeparttable} -->
<!-- %	\end{adjustwidth} -->
<!-- \end{table}  -->


\begin{table}[h] \centering 
	\caption{Covariate vectors for prediction in the year 2100} 
	\begin{threeparttable} %%% added %%% 
		\begin{tabularx}{.9\textwidth}{@{\extracolsep{1pt}} X A A A A } 
			%\begin{tabularx}{\textwidth}{X c c c c} 
			%\hline\hline
			\toprule
			&\multicolumn{1}{c}{RCP 2.6}&\multicolumn{1}{c}{RCP 4.5}&\multicolumn{1}{c}{RCP 6.0}&\multicolumn{1}{c}{RCP 8.5}\\
			%&\multicolumn{1}{c}{\footnotesize420 ppmv CO$_2$}&\multicolumn{1}{c}{\footnotesize540 ppmv CO$_2$}&\multicolumn{1}{c}{\footnotesize670 ppmv CO$_2$}&\multicolumn{1}{c}{\footnotesize940 ppmv CO$_2$}\\
			%\hline
			%\\[-1.8ex] 
			\midrule
			$RF_{2100}$  																			& 2.626		& 4.281		& 5.522		& 8.340		\\ 
			\hspace{5 pt} \textit{CO$_2$ component}	& \multicolumn{1}{c}{\textit{\hspace{1em}85\%}}	&	\multicolumn{1}{c}{\textit{\hspace{1em}83\%}}	&	\multicolumn{1}{c}{\textit{\hspace{1em}86\%}}	&	\multicolumn{1}{c}{\textit{\hspace{1em}78\%}}	\\
			\hspace{5 pt} \textit{Solar component}		& \multicolumn{1}{c}{\textit{\hspace{1em} 7\%}}	&	\multicolumn{1}{c}{\textit{\hspace{1em} 4\%}}	&	\multicolumn{1}{c}{\textit{\hspace{1em} 3\%}}	&	\multicolumn{1}{c}{\textit{\hspace{1em} 2\%}}	\\
			\\[-1.8ex] 
			$\overline{VOLC}$																	& 0.017		& 0.017		& 0.017		& 0.017		\\
			\\[-1.8ex] 
			$\overline{SOI}$																	&\text{-}0.079	&\text{-}0.079	&\text{-}0.079	&\text{-}0.079	\\
			\\[-1.8ex] 
			$\overline{AMO}$ 																	&\text{-}0.002 &\text{-}0.002	&\text{-}0.002	&\text{-}0.002	\\
			%\hline\hline
			\bottomrule
		\end{tabularx}
		\begin{tablenotes}
			\footnotesize
			\item \textit{Notes:} Covariates are used to predict the global mean surface temperature anomaly in the year 2100. The Representative Concentration Pathways (RCPs) are a family of forcing scenarios developed for the IPCC \cite{van2011rcp}. Each RCP has a core component of atmospheric CO$_2$ concentrations, measured in parts per million volume (ppmv). With regard to the covariates in the regression model, total radiative forcing ($RF$) and volcanic aerosols ($VOLC$) are measured in Wm$^{-2}$. The Southern Oscillation Index ($SOI$) and Atlantic Multidecadal Oscilliation ($AMO$) are measured as scaled indices. Future values for $RF$ are taken from the RCP database. For the rest, historical mean values are used.
		\end{tablenotes}
	\end{threeparttable} 
	\label{tab:covariate}
\end{table}


\newpage
\pagebreak

# Figures

```{r scc-fig, fig.cap = 'Social cost of carbon (US\\$2005 per ton). The results for each agent type are obtained from 10,000 simulation runs of PAGE09 \\cite{hope2011page09}. Posterior TCR distributions serve as key inputs to the model, while the remaining parameters are set to the PAGE09 model defaults. The x-axis is truncated at 100 to aid visual inspection; the uppermost tails of the distributions being well in excess of the range given here.', fig.pos = 'h'}
scc = melt(scc, measure.vars = names(scc), 
					 variable.name = 'prior', value.name = 'scc')
scc[, prior := factor(match_priors(prior), levels=prior_names)]
ggplot(scc, aes(x = scc, col = prior)) +
      geom_line(stat = "density") +
      xlim(-10, 100) + ## NB: x-axis is truncated to aid visual inspection!
      labs(
        x = "US$ (2005)", 
        y = "Density") + 
      scale_colour_manual(values = prior_cols) +
      guides(col = guide_legend(nrow = 2)) +
      theme(
        legend.position = "bottom",
        legend.title = element_blank()
        )
```

\newpage
